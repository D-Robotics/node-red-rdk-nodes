[
    {
        "id": "edgesam_tab",
        "type": "tab",
        "label": "EdgeSAM åˆ†å‰²ä¸€åˆ‡",
        "disabled": false,
        "info": "# EdgeSAM åˆ†å‰²ä¸€åˆ‡\n\n## åŠŸèƒ½ä»‹ç»\n\nEdgeSAMåˆ†å‰²ç®—æ³•ï¼Œæ”¯æŒUSBè§†é¢‘æµå’ŒMIPIè§†é¢‘æµä¸¤ç§æ¨¡å¼ã€‚EdgeSAMä¾èµ–æ£€æµ‹æ¡†è¾“å…¥è¿›è¡Œåˆ†å‰²ï¼Œæ— éœ€æŒ‡å®šç›®æ ‡çš„ç±»åˆ«ä¿¡æ¯ï¼Œä»…éœ€æä¾›æ¡†ã€‚\n\n## ä½¿ç”¨æµç¨‹\n\n### æ¨¡å¼1ï¼šUSBè§†é¢‘æµåˆ†å‰²ï¼ˆå®æ—¶ï¼‰\n1. **å¯åŠ¨è§†é¢‘æµ**ï¼šç‚¹å‡»\"ğŸ¥ USBæ‘„åƒå¤´è§†é¢‘æµ\"æŒ‰é’®\n2. **æŸ¥çœ‹å¯è§†åŒ–**ï¼šç‚¹å‡»\"æ‰“å¼€å¯è§†åŒ–é¡µé¢\"åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å®æ—¶åˆ†å‰²ç»“æœ\n3. **åœæ­¢æœåŠ¡**ï¼šå®Œæˆåç‚¹å‡»\"åœæ­¢æ‰€æœ‰æœåŠ¡\"\n\n### æ¨¡å¼2ï¼šMIPIè§†é¢‘æµåˆ†å‰²ï¼ˆå®æ—¶ï¼‰\n1. **å¯åŠ¨è§†é¢‘æµ**ï¼šç‚¹å‡»\"ğŸ“¹ MIPIæ‘„åƒå¤´è§†é¢‘æµ\"æŒ‰é’®\n2. **æŸ¥çœ‹å¯è§†åŒ–**ï¼šç‚¹å‡»\"æ‰“å¼€å¯è§†åŒ–é¡µé¢\"åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å®æ—¶åˆ†å‰²ç»“æœ\n3. **åœæ­¢æœåŠ¡**ï¼šå®Œæˆåç‚¹å‡»\"åœæ­¢æ‰€æœ‰æœåŠ¡\"\n\n## æ”¯æŒå¹³å°\n\n- RDK X5\n- RDK S100\n\n## ç®—æ³•ä¿¡æ¯\n\n| æ¨¡å‹ | å¹³å° | è¾“å…¥å°ºå¯¸ | æ¨ç†å¸§ç‡(fps) |\n|------|------|---------|-------------|\n| edgesam | X5 | 1Ã—3Ã—512Ã—512 | 9.09 |\n| edgesam | S100 | 1Ã—3Ã—512Ã—512 | 77.0 |\n\n## æ ¸å¿ƒé€šä¿¡é…ç½®\n\n### WebSocketè§†é¢‘æµ\n- **è§†é¢‘æµåœ°å€**: `http://{host}:8000`\n- **å›¾åƒTopic**: `/image` (JPEGç¼–ç çš„å›¾åƒæµ)\n- **æ€§èƒ½**: å®æ—¶æ£€æµ‹ï¼Œå»¶è¿Ÿä½\n\n## æ³¨æ„äº‹é¡¹\n\n- EdgeSAMä¾èµ–æ£€æµ‹æ¡†è¾“å…¥ï¼Œæœ¬ç¤ºä¾‹ä½¿ç”¨å›ºå®šæ¡†ï¼ˆå›¾ç‰‡ä¸­å¤®ï¼‰è¿›è¡Œåˆ†å‰²\n- è§†é¢‘æµæ¨¡å¼éœ€è¦å…ˆå¯åŠ¨è§†é¢‘æµï¼Œå†æ‰“å¼€å¯è§†åŒ–é¡µé¢\n- åˆ†å‰²è¿‡ç¨‹éœ€è¦å‡ ç§’é’Ÿæ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…",
        "env": []
    },
    {
        "id": "comment_video_section",
        "type": "comment",
        "z": "edgesam_tab",
        "name": "ğŸ¥ USBè§†é¢‘æµåˆ†å‰²æµç¨‹",
        "info": "å¯åŠ¨USBæ‘„åƒå¤´å®æ—¶è§†é¢‘æµï¼Œè¿›è¡Œè¿ç»­åˆ†å‰²",
        "x": 150,
        "y": 200,
        "wires": []
    },
    {
        "id": "inject_usb_video",
        "type": "inject",
        "z": "edgesam_tab",
        "name": "ğŸ¥ USBæ‘„åƒå¤´è§†é¢‘æµ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "usb_video",
        "payload": "start",
        "payloadType": "str",
        "x": 140,
        "y": 260,
        "wires": [
            [
                "exec_usb_video"
            ]
        ]
    },
    {
        "id": "exec_usb_video",
        "type": "exec",
        "z": "edgesam_tab",
        "name": "USBè§†é¢‘æµå¯åŠ¨å™¨",
        "command": "cd /tmp && mkdir -p logs && chmod 777 logs && source /opt/tros/humble/setup.bash && echo '=== è‡ªåŠ¨è¯†åˆ«USBæ‘„åƒå¤´è®¾å¤‡ ===' && DEVICE='' && for vdev in /dev/video{0..15}; do if [ -e \"$vdev\" ] && [ -c \"$vdev\" ]; then USB_PATH=$(udevadm info \"$vdev\" 2>&1 | grep 'ID_PATH=' | head -1 | cut -d'=' -f2) && if [ -n \"$USB_PATH\" ] && echo \"$USB_PATH\" | grep -qi usb; then if v4l2-ctl --device=\"$vdev\" --info >/dev/null 2>&1; then DEVICE=\"$vdev\" && echo \"âœ“ æ‰¾åˆ°USBæ‘„åƒå¤´: $DEVICE\" && v4l2-ctl --device=\"$DEVICE\" --info 2>&1 | grep -E 'Driver name|Card type' | head -2 && break; fi; fi; fi; done && if [ -z \"$DEVICE\" ]; then echo 'âš ï¸ æœªé€šè¿‡USBè·¯å¾„æ‰¾åˆ°è®¾å¤‡ï¼Œå°è¯•é€šè¿‡by-path...' && if [ -d /dev/v4l/by-path ]; then for link in /dev/v4l/by-path/*usb*-video-index0; do if [ -L \"$link\" ]; then DEVICE=$(readlink -f \"$link\") && if v4l2-ctl --device=\"$DEVICE\" --info >/dev/null 2>&1; then echo \"âœ“ é€šè¿‡by-pathæ‰¾åˆ°: $DEVICE\" && break; fi; fi; done; fi; fi && if [ -z \"$DEVICE\" ]; then echo 'âŒ æœªæ‰¾åˆ°å¯ç”¨çš„USBæ‘„åƒå¤´è®¾å¤‡' && echo 'è¯·æ£€æŸ¥USBæ‘„åƒå¤´æ˜¯å¦å·²è¿æ¥' && exit 1; fi && echo \"ä½¿ç”¨è®¾å¤‡: $DEVICE\" && ls -l \"$DEVICE\" 2>&1 && echo '=== å¯åŠ¨EdgeSAM USBè§†é¢‘æµï¼ˆåŒ…å«WebSocketæœåŠ¡ï¼‰ ===' && export CAM_TYPE=usb && ros2 launch mono_edgesam sam.launch.py device:=\"$DEVICE\" 2>&1 || (ERR_CODE=$? && echo \"å¯åŠ¨å¤±è´¥ï¼Œé”™è¯¯ä»£ç : $ERR_CODE\" && exit $ERR_CODE)",
        "addpay": false,
        "append": "",
        "useSpawn": true,
        "timer": "0",
        "oldrc": false,
        "x": 380,
        "y": 260,
        "wires": [
            [
                "debug_usb_video_output"
            ],
            [
                "debug_usb_video_error"
            ],
            []
        ]
    },
    {
        "id": "debug_usb_video_output",
        "type": "debug",
        "z": "edgesam_tab",
        "name": "USBè§†é¢‘æµè¾“å‡º",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 650,
        "y": 240,
        "wires": []
    },
    {
        "id": "debug_usb_video_error",
        "type": "debug",
        "z": "edgesam_tab",
        "name": "USBè§†é¢‘æµé”™è¯¯",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 280,
        "wires": []
    },
    {
        "id": "comment_mipi_video_section",
        "type": "comment",
        "z": "edgesam_tab",
        "name": "ğŸ“¹ MIPIè§†é¢‘æµåˆ†å‰²æµç¨‹",
        "info": "å¯åŠ¨MIPIæ‘„åƒå¤´å®æ—¶è§†é¢‘æµï¼Œè¿›è¡Œè¿ç»­åˆ†å‰²",
        "x": 150,
        "y": 320,
        "wires": []
    },
    {
        "id": "inject_mipi_video",
        "type": "inject",
        "z": "edgesam_tab",
        "name": "ğŸ“¹ MIPIæ‘„åƒå¤´è§†é¢‘æµ",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "mipi_video",
        "payload": "start",
        "payloadType": "str",
        "x": 140,
        "y": 380,
        "wires": [
            [
                "exec_mipi_video"
            ]
        ]
    },
    {
        "id": "exec_mipi_video",
        "type": "exec",
        "z": "edgesam_tab",
        "name": "MIPIè§†é¢‘æµå¯åŠ¨å™¨",
        "command": "cd /tmp && mkdir -p logs && chmod 777 logs && source /opt/tros/humble/setup.bash && export CAM_TYPE=mipi && ros2 launch mono_edgesam sam.launch.py",
        "addpay": false,
        "append": "",
        "useSpawn": true,
        "timer": "120",
        "oldrc": false,
        "x": 380,
        "y": 380,
        "wires": [
            [
                "debug_mipi_video_output"
            ],
            [
                "debug_mipi_video_error"
            ],
            []
        ]
    },
    {
        "id": "debug_mipi_video_output",
        "type": "debug",
        "z": "edgesam_tab",
        "name": "MIPIè§†é¢‘æµè¾“å‡º",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 650,
        "y": 360,
        "wires": []
    },
    {
        "id": "debug_mipi_video_error",
        "type": "debug",
        "z": "edgesam_tab",
        "name": "MIPIè§†é¢‘æµé”™è¯¯",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 650,
        "y": 400,
        "wires": []
    },
    {
        "id": "comment_browser_section",
        "type": "comment",
        "z": "edgesam_tab",
        "name": "2ï¸âƒ£ æŸ¥çœ‹æ£€æµ‹ç»“æœ",
        "info": "åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å®æ—¶æ£€æµ‹ç”»é¢",
        "x": 200,
        "y": 440,
        "wires": []
    },
    {
        "id": "inject_browser",
        "type": "inject",
        "z": "edgesam_tab",
        "name": "æ‰“å¼€å¯è§†åŒ–é¡µé¢",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "http://{host}:8000",
        "payloadType": "str",
        "x": 140,
        "y": 480,
        "wires": [
            [
                "openurl_browser"
            ]
        ]
    },
    {
        "id": "openurl_browser",
        "type": "rdk-tools openurl",
        "z": "edgesam_tab",
        "name": "",
        "x": 380,
        "y": 480,
        "wires": []
    },
    {
        "id": "comment_control_section",
        "type": "comment",
        "z": "edgesam_tab",
        "name": "ğŸ® æ§åˆ¶åŠŸèƒ½",
        "info": "åœæ­¢åˆ†å‰²æœåŠ¡",
        "x": 150,
        "y": 680,
        "wires": []
    },
    {
        "id": "inject_stop",
        "type": "inject",
        "z": "edgesam_tab",
        "name": "åœæ­¢åˆ†å‰²æœåŠ¡",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "stop",
        "payloadType": "str",
        "x": 140,
        "y": 740,
        "wires": [
            [
                "exec_stop_all"
            ]
        ]
    },
    {
        "id": "exec_stop_all",
        "type": "exec",
        "z": "edgesam_tab",
        "name": "åœæ­¢æœåŠ¡",
        "command": "sudo pkill -9 -f hobot_usb_cam; sudo pkill -9 -f mono_edgesam; sudo pkill -9 -f hobot_codec_republish; sudo pkill -9 -f websocket; sudo pkill -9 -f python3; sudo pkill -9 -f 'ros2 launch'; sudo pkill -9 -f 'ros2 run'; sleep 2; sudo rm -rf /dev/shm/*; ros2 daemon stop 2>/dev/null; sleep 1; echo 'âœ“ æœåŠ¡å·²å½»åº•åœæ­¢ï¼Œèµ„æºå·²é‡Šæ”¾'",
        "addpay": false,
        "append": "",
        "useSpawn": false,
        "timer": "10",
        "oldrc": false,
        "x": 350,
        "y": 740,
        "wires": [
            [
                "debug_stop_info"
            ],
            [],
            []
        ]
    },
    {
        "id": "debug_stop_info",
        "type": "debug",
        "z": "edgesam_tab",
        "name": "åœæ­¢çŠ¶æ€",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "payload",
        "statusType": "auto",
        "x": 550,
        "y": 740,
        "wires": []
    },
    {
        "id": "global_config_edgesam",
        "type": "global-config",
        "env": [],
        "modules": {
            "node-red-node-rdk-camera": "0.0.17",
            "node-red-contrib-image-tools": "2.1.1"
        }
    }
]

